#!/bin/bash

host=$(rg '^Host\s+(.*)' ~/.ssh/config --no-heading | awk '{print $2}' | fzf --prompt="é€‰æ‹©è¿œç¨‹ä¸»æœº: ")
[ -z "$host" ] && echo "âŒ æœªé€‰æ‹©ä¸»æœº" && return 1

file=$(ssh "$host" 'fd . --max-depth 2 --hidden --follow --color=never ~' |
  fzf --prompt="é€‰æ‹©è¦ä¸‹è½½çš„è¿œç¨‹æ–‡ä»¶/ç›®å½•: " \
    --preview "ssh '"$host"' ls -lh {}")
file="${file%%/}"
[ -z "$file" ] && echo "âŒ æœªé€‰æ‹©æ–‡ä»¶" && return 1

echo -n "ğŸ“‚ è¯·è¾“å…¥æœ¬åœ°ä¿å­˜ç›®å½• [é»˜è®¤: å½“å‰ç›®å½•]: "
read local_dir
local_dir=${local_dir:-.}

echo "â¬‡ï¸ æ­£åœ¨ä¸‹è½½: $host:$file â†’ $local_dir"

rsync -avzPr "${host}:$file" "$local_dir"
